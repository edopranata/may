import{g as m,z as f,u as T,c,a as u,b as t,e as h,i as g,x as C,d as e,k as E,j as b,y as H,w as D,t as i,F,n as M,o as d,H as P,f as v,L as B,s as K,q as L,_ as z,S as A}from"./app.f33b5c0d.js";import{_ as q}from"./Breadcrumb.de4c8a73.js";import{_ as J}from"./PageTitle.dd8debfd.js";import{s as O}from"./multiselect.ddaa6662.js";import{s as x}from"./library.595eb791.js";const G={class:"modal modal-bottom sm:modal-middle"},Q={class:"modal-box"},W=e("h3",{class:"font-bold text-lg"},"Data timbangan sudah benar?",-1),X=e("p",{class:"py-4"},"Simpan data dan lanjut tambahkan data timbangan yang lainnya",-1),Y={class:"modal-action"},Z=["disabled"],ee=e("label",{for:"modal-save",class:"btn btn-warning"},"Batal",-1),te={class:"modal modal-bottom sm:modal-middle"},se={class:"modal-box"},ae={key:0,class:"font-bold text-lg"},oe={key:1,class:"font-bold text-lg"},le={class:"modal-action flex justify-between"},re={class:"flex justify-between space-x-2"},ne=["disabled"],ie=e("label",{for:"modal-delete",class:"btn btn-warning"},"Batal",-1),de={class:"px-4 grid gap-4"},ce={class:"card w-full rounded-none border-2 border-info shadow-xl"},ue={class:"card-body grid md:grid-cols-3 gap-4"},pe={class:"form-control w-full"},_e=e("label",{class:"label"},[e("span",{class:"label-text"},"Tanggal Transaksi")],-1),be={class:"form-control w-full"},me=e("label",{class:"label"},[e("span",{class:"label-text"},"Mobil")],-1),fe=["value"],he={class:"form-control w-full"},ge=e("label",{class:"label"},[e("span",{class:"label-text"},"Supir")],-1),ve=["value"],xe={class:"card w-full rounded-none border-2 border-info shadow-xl"},ye={class:"grid md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"},we={class:"form-control w-full md:col-span-2 lg:col-span-3 xl:col-span-2"},ke=e("label",{class:"label"},[e("span",{class:"label-text"},"Nama Petani")],-1),Ie={class:"label h-8"},Te={key:0,class:"label-text-alt text-error"},Ce={class:"form-control w-full"},De=e("label",{class:"label"},[e("span",{class:"label-text"},"Berat")],-1),Fe={class:"label h-8"},Be={key:0,class:"label-text-alt text-error"},Ue={class:"form-control w-full"},Ne=e("label",{class:"label"},[e("span",{class:"label-text"},"Harga Beli")],-1),Ve={class:"label h-8"},Se={key:0,class:"label-text-alt text-error"},$e={class:"form-control w-full"},je=e("label",{class:"label"},[e("span",{class:"label-text"},"Total")],-1),Re={class:"form-control w-full"},Ee={class:"form-control w-full pt-9"},He=["disabled"],Me={class:"w-full overflow-y-auto mt-10 md:mt-0"},Pe={class:"w-full text-left text-base min-w-4xl"},Ke=e("thead",{class:"text-sm uppercase bg-primary/20"},[e("tr",null,[e("th",{class:"py-3 px-6"},"#"),e("th",{class:"py-3 px-6"},"Petani"),e("th",{class:"py-3 px-6 text-right"},"Berat"),e("th",{class:"py-3 px-6 text-right"},"Harga"),e("th",{class:"py-3 px-6 text-right"},"Total"),e("th",{class:"py-3 px-6"},"Invoice")])],-1),Le=["onClick"],ze={class:"group-hover:bg-base-300 py-4 px-6"},Ae={class:"group-hover:bg-base-300 py-4 px-6"},qe={class:"font-bold"},Je={class:"text-sm opacity-50"},Oe={class:"group-hover:bg-base-300 py-4 px-6 text-right"},Ge={class:"group-hover:bg-base-300 py-4 px-6 text-right"},Qe={class:"group-hover:bg-base-300 py-4 px-6 text-right"},We={class:"group-hover:bg-base-300 py-4 px-6"},Xe={class:"flex justify-between"},Ye={key:1,class:"border-t"},Ze=e("th",{class:"group-hover:bg-base-300 py-4 px-6 text-right",colspan:"2"},"Total",-1),et={class:"group-hover:bg-base-300 py-4 px-6 text-right"},tt=e("td",{class:"group-hover:bg-base-300 py-4 px-6"},null,-1),st={class:"group-hover:bg-base-300 py-4 px-6 text-right"},at=e("td",{class:"group-hover:bg-base-300 py-4 px-6"},null,-1),ct={__name:"TradeCreate",props:{trade:Object,farmers:Array},setup(U){const r=U,N=[{url:route("transaction.index"),label:"Transaksi"},{url:route("transaction.trade.index"),label:"Beli Sawit Petani"},{url:null,label:"Timbangan Kebun "+r.trade.car.no_pol.toUpperCase()+" - "+r.trade.car.name.toUpperCase()}],p=m(!1),_=m(!1),y=m(),w=m(),k=m();f(p,n=>{n&&setTimeout(function(){y.value.focus()},100)}),f(_,n=>{n&&setTimeout(function(){w.value.focus()},100)});const s=T({date:r.trade.trade_date,farmer_id:0,weight:0,price:0,total:0}),l=T({trade_detail_id:null,id:0,farmer_id:0,status:!1,invoice:null}),V=n=>{let a=r.trade.details[n];l.trade_detail_id=a.id,l.id=a.id,l.farmer_id=a.farmer_id,l.invoice=a.invoice_trade,l.status=!!a.farmer_status,_.value=!0};f(()=>A.cloneDeep(s),(n,a)=>{n.weight&&n.price&&(s.total=n.weight*n.price)});const S=()=>{s.patch(route("transaction.trade.update",r.trade.id),{onSuccess:()=>{j()},onFinish:()=>{p.value=!1}})},$=()=>{l.delete(route("transaction.trade.destroy",l.id),{onSuccess:()=>{R()},onFinish:()=>{_.value=!1}})},j=()=>{s.clearErrors(),s.reset(),s.defaults({date:r.trade.trade_date,farmer_id:0,weight:0,price:0,total:0}),p.value=!1,setTimeout(function(){k.value.focus()},300)},R=()=>{l.clearErrors(),l.reset(),l.defaults({id:0,farmer_id:0}),_.value=!1};return(n,a)=>(d(),c(F,null,[u(t(P),{title:"Transaksi Jual Beli"}),u(q,{links:N}),u(J,{classes:"bg-base-content",class:""},{default:h(()=>[v("Timbangan Kebun")]),_:1}),g(e("input",{type:"checkbox",id:"modal-save","onUpdate:modelValue":a[0]||(a[0]=o=>p.value=o),class:"modal-toggle"},null,512),[[C,p.value]]),e("div",G,[e("div",Q,[W,X,e("div",Y,[e("button",{disabled:t(s).processing,ref_key:"btn_save",ref:y,type:"button",class:"btn",onClick:S},"Tambah",8,Z),ee])])]),g(e("input",{type:"checkbox",id:"modal-delete","onUpdate:modelValue":a[1]||(a[1]=o=>_.value=o),class:"modal-toggle"},null,512),[[C,_.value]]),e("div",te,[e("div",se,[t(l).status?(d(),c("h3",ae,"Tidak dapat dihapus, karena invoice telah terbit")):(d(),c("h3",oe,"Cetak invoice atau hapus data ini?")),e("div",le,[e("div",null,[u(t(B),{as:"button",href:t(l).status?n.route("print.invoice.farmer.show",t(l).invoice.invoice_id):n.route("transaction.invoice.farmer.show",t(l).farmer_id),class:"btn btn-info"},{default:h(()=>[v(i(t(l).status?"Print Invoice":"Buat Invoice"),1)]),_:1},8,["href"])]),e("div",re,[t(l).trade_detail_id?(d(),E(t(B),{key:0,as:"button",href:n.route("transaction.trade.farmer",t(l).trade_detail_id),class:"btn btn-accent"},{default:h(()=>[v("Ubah")]),_:1},8,["href"])):b("",!0),e("button",{disabled:t(s).processing||t(l).status,ref_key:"btn_delete",ref:w,type:"button",class:"btn btn-error",onClick:$},"Hapus",8,ne),ie])])])]),e("section",de,[e("div",ce,[e("div",ue,[e("div",pe,[_e,g(e("input",{readonly:"","onUpdate:modelValue":a[2]||(a[2]=o=>t(s).date=o),type:"date",class:"input input-info input-bordered w-full"},null,512),[[H,t(s).date]])]),e("div",be,[me,e("input",{readonly:"",type:"text",value:r.trade.car.no_pol.toUpperCase()+" - "+r.trade.car.name.toUpperCase(),class:"input input-info input-bordered w-full"},null,8,fe)]),e("div",he,[ge,e("input",{readonly:"",type:"text",value:r.trade.driver.name.toUpperCase(),class:"input input-info input-bordered w-full"},null,8,ve)])])]),e("div",xe,[e("form",{onSubmit:a[9]||(a[9]=D(o=>p.value=!0,["prevent"])),class:"card-body"},[e("div",ye,[e("div",we,[ke,u(t(O),{ref_key:"opt_farmer",ref:k,class:"select select-bordered rounded",searchable:!0,modelValue:t(s).farmer_id,"onUpdate:modelValue":a[3]||(a[3]=o=>t(s).farmer_id=o),options:r.farmers},null,8,["modelValue","options"]),e("label",Ie,[t(s).errors.farmer_id?(d(),c("span",Te,i(t(s).errors.farmer_id),1)):b("",!0)])]),e("div",Ce,[De,u(t(x),{onFocus:a[4]||(a[4]=o=>t(s).clearErrors("weight")),options:{precision:0,prefix:"",suffix:" Kg",isInteger:!0},readonly:t(s).processing,value:t(s).weight,"onUpdate:value":a[5]||(a[5]=o=>t(s).weight=o),class:"input input-bordered"},null,8,["readonly","value"]),e("label",Fe,[t(s).errors.weight?(d(),c("span",Be,i(t(s).errors.weight),1)):b("",!0)])]),e("div",Ue,[Ne,u(t(x),{onFocus:a[6]||(a[6]=o=>t(s).clearErrors("price")),options:{precision:0,prefix:"Rp. ",suffix:"",isInteger:!0},readonly:t(s).processing,value:t(s).price,"onUpdate:value":a[7]||(a[7]=o=>t(s).price=o),class:"input input-bordered"},null,8,["options","readonly","value"]),e("label",Ve,[t(s).errors.price?(d(),c("span",Se,i(t(s).errors.price),1)):b("",!0)])]),e("div",$e,[je,e("div",Re,[u(t(x),{options:{precision:0,prefix:"Rp. ",suffix:"",isInteger:!0},readonly:"",value:t(s).total,"onUpdate:value":a[8]||(a[8]=o=>t(s).total=o),class:"input input-bordered"},null,8,["options","value"])])]),e("div",Ee,[e("button",{disabled:t(s).processing,type:"submit",class:"btn"},"Tambahkan",8,He)])]),e("div",Me,[e("table",Pe,[Ke,e("tbody",null,[r.trade.details.length?(d(!0),c(F,{key:0},M(r.trade.details,(o,I)=>(d(),c("tr",{class:"hover:cursor-pointer group border-b",onClick:D(ot=>V(I),["prevent"])},[e("td",ze,i(I+1),1),e("td",Ae,[e("div",null,[e("div",qe,i(o.farmer.name),1),e("div",Je,i(o.farmer.phone),1)])]),e("td",Oe,i(Intl.NumberFormat("id-ID",{style:"unit",unit:"kilogram"}).format(o.weight)),1),e("td",Ge,i(Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o.price)),1),e("td",Qe,i(Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o.total)),1),e("td",We,[e("div",Xe,[e("span",{class:K(["badge badge-lg",o.farmer_status?"badge-success":"badge-error"])},i(o.farmer_status?"Terbit":"Belum"),3),u(z,{path:t(L)},null,8,["path"])])])],8,Le))),256)):b("",!0),r.trade.details.length?(d(),c("tr",Ye,[Ze,e("th",et,i(Intl.NumberFormat("id-ID",{style:"unit",unit:"kilogram"}).format(r.trade.gross_weight)),1),tt,e("th",st,i(Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r.trade.gross_total)),1),at])):b("",!0)])])])],32)])])],64))}};export{ct as default};
